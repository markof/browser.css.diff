function initSelectComfirmClickDelegate(){function e(){var e=i();if(e){var r=!1;return e.map(function(e){e.valid&&(r=!0)}),r?void o(e):(a(1,"请至少选择一个浏览器"),!1)}}function o(e){var o=0,r=e;r.map(function(e){if("selfBrowser"==e.valid){o++;var i=document.createElement("div"),l=[];for(var a in i.style)l.push(a);e.css=l,e.platform="您的浏览器",e.family="您的浏览器",e.version="您的浏览器",o--}else e.valid&&(o++,$.ajax({url:"http://markof.cn:8800/browser/",data:{platform:e.platform,family:e.family,version:e.version},dataType:"json",success:function(i){o--,e.css=i.cssInfo,0==o&&n(r)},error:function(i){o--,e.valid=!1,0==o&&n(r)}}))}),0==o&&n(r)}function r(e){for(var o=[],r=0;r<e.length;r++)-1==o.indexOf(e[r])&&o.push(e[r]);return o}function n(e){var o=[],n=0;e.map(function(e){o=o.concat(e.css),e.valid&&n++}),o=r(o),o.shift();var i=$('<div class="row row-title"></div>'),l=$('<div class="row row-title"></div>'),a=$('<div class="row row-title"></div>');i.append('<div class="col">平台</div>'),l.append('<div class="col">浏览器</div>'),a.append('<div class="col">版本</div>'),e.map(function(e){e.valid&&(i.append('<div class="col">'+e.platform+"</div>"),l.append('<div class="col">'+e.family+"</div>"),a.append('<div class="col">'+e.version+"</div>"))}),$(".table").append(i),$(".table").append(l),$(".table").append(a),o.map(function(o){var r=$('<div class="row"></div>');r.append('<div class="col col-title">'+o+"</div>"),e.map(function(e){if(e.valid){var n=-1==e.css.indexOf(o)?"false":"true";r.append('<div class="col"><i class="iconfont icon-'+n+'"></i></div>')}}),$(".table").append(r)}),$(".browserSelector").fadeOut(function(){var e="请选择浏览器",o="./";history.pushState("",e,o),$(".table").fadeIn()})}function i(){for(var e=$(".browserSelector .browsers").children(),o=null,r="",n=[],i=0;i<e.length;i++){var t={index:i,valid:!1,platform:null,family:null,version:null},s=$(e[i]),c=s.children(".platformSelector").val(),d=s.children(".familySelector").val(),p=s.children(".versionSelector").val();if("undefined"!=typeof c&&"unselected"!=c)if("selfBrowser"!=c){if("unselected"==d||"unselected"==p){r="请完整选择“浏览器”和“版本”",o=i+1;break}t.valid=!0,t.platform=c,t.family=d,t.version=p,l(),n.push(t)}else t.valid="selfBrowser",n.push(t);else t.valid=!1,n.push(t)}return o?(a(o,r),null):n}function l(){var e=$(".browserSelector"),o=e.children(".more");o.slideUp(function(){o.remove()})}function a(e,o){var r=$('<div class="more"><div class="body"><div class="arrow arrow-position-'+e+'-4"></div><div class="message center">'+o+"</div></div></div>"),n=$(".browserSelector");n.children(".more").remove(),r.hide(),n.children(".browsers").after(r),r.slideDown()}$(".browserSelector .confirm").on("click",e),$(".browserSelector .confirm").tap(e),$(".browserSelector .browsers").delegate(".versionSelector","change",i)}function initBrowserSelectorClickDelegate(){function e(){var e=browser.browserList,o=$(this),r=$(o.parent()),n=r.children(".platformSelector").val(),i=o.val(),l=null;r.children(".versionSelector").remove(),e.platform.map(function(e){e.code==n&&e.browsers.map(function(e){e.code==i&&(l=$('<select class="versionSelector"></select>'),l.hide(),l.append('<option value="unselected">请选择版本</option>'),e.versions.map(function(e){l.append("<option>"+e.code+"</option>")}),r.append(l),l.fadeIn())})})}function o(){var e=browser.browserList,o=$(this),r=$(o.parent()),n=o.val(),i=null;r.children(".familySelector").remove(),r.children(".versionSelector").remove(),e.platform.map(function(e){e.code==n&&(i=$('<select class="familySelector"></select>'),i.html(""),i.hide(),i.append('<option value="unselected">请选择浏览器</option>'),e.browsers.map(function(e){i.append("<option>"+e.code+"</option>")}),r.append(i),i.fadeIn())})}function r(){var e=browser.browserList,o=$('<select class="platformSelector"></select>'),r=$(this),n=$(r.parent());o.append('<option value="unselected">请选择操作系统</option>'),o.append('<option value="selfBrowser">您当前的浏览器</option>'),e.platform.map(function(e){o.append("<option>"+e.code+"</option>")}),o.hide(),n.append(o),$(this).fadeOut(function(){o.fadeIn()})}$(".browserSelector .browsers").delegate(".iconfont","click",r),$(".browserSelector .browsers").delegate(".platformSelector","change",o),$(".browserSelector .browsers").delegate(".familySelector","change",e),$(".browsers .iconfont").tap(r)}function initTableClickDelegate(){var e=$('<div class="more"></div>'),o=$('<div class="body"></div>'),r=$('<div class="arrow"></div>'),n=$("<div><div>");e.append(o),o.append(r),o.append(n),console.log(e);var i=null;e.hide(),$(".table").delegate(".col-title","click",function(){var o=$(this);i&&i.removeClass("active"),i=o.parent(),i.addClass("active"),e.slideUp(function(){o.parent().after(e),e.slideDown()}),css.get(o.html(),function(e,o){e?n.html("内容待补充..."):n.html(o)})})}function initWallpaper(){var e=new wallpaper;e.getRandomWallpaper(function(e,o){if(!e){var r=new Image;r.onload=function(){$(".cover").css({"background-color":"rgba(0,0,0,1)"}),$("body").css({"background-image":"url("+o.response.image.preview.url+")"});var e=100,r=setInterval(function(){$(".cover").css({"background-color":"rgba(0,0,0,"+e/100+")"}),e--,65>e&&clearInterval(r)},100)},r.onerror=function(e){console.log(e)},r.src=o.response.image.preview.url}})}var browser=new Browser,css=new Css;$(document).ready(function(){initWallpaper(),browser.reportBrowserCss(),browser.initBrowserList(),initTableClickDelegate(),initBrowserSelectorClickDelegate(),initSelectComfirmClickDelegate()});