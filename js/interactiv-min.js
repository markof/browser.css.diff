function initSelectComfirmClickDelegate(){function e(){var e=o();if(e){var l=!1;return e.map(function(e){e.valid&&(l=!0)}),l?void r(e):(n(1,"请至少选择一个浏览器"),!1)}}function r(e){var r=0,o=e;o.map(function(e){if("selfBrowser"==e.valid){r++;var l=document.createElement("div"),n=[];for(var i in l.style)n.push(i);e.css=n,e.platform="您的浏览器",e.family="您的浏览器",e.version="您的浏览器",r--}else e.valid&&(r++,$.ajax({url:"http://127.0.0.1:8800/browser/",data:{platform:e.platform,family:e.family,version:e.version},dataType:"json",success:function(l){r--,e.css=l.cssInfo,0==r&&renderCssTable(o)},error:function(l){r--,e.valid=!1,0==r&&renderCssTable(o)}}))}),0==r&&renderCssTable(o)}function o(){for(var e=$(".browserSelector .browsers").children(),r=null,o="",i=[],a=0;a<e.length;a++){var t={index:a,valid:!1,platform:null,family:null,version:null},s=$(e[a]),c=s.children(".platformSelector").val(),d=s.children(".familySelector").val(),p=s.children(".versionSelector").val();if("undefined"!=typeof c&&"unselected"!=c)if("selfBrowser"!=c){if("unselected"==d||"unselected"==p){o="请完整选择“浏览器”和“版本”",r=a+1;break}t.valid=!0,t.platform=c,t.family=d,t.version=p,l(),i.push(t)}else t.valid="selfBrowser",i.push(t);else t.valid=!1,i.push(t)}return r?(n(r,o),null):i}function l(){var e=$(".browserSelector"),r=e.children(".more");r.slideUp(function(){r.remove()})}function n(e,r){var o=$('<div class="more"><div class="body"><div class="arrow arrow-position-'+e+'-4"></div><div class="message center">'+r+"</div></div></div>"),l=$(".browserSelector");l.children(".more").remove(),o.hide(),l.children(".browsers").after(o),o.slideDown()}$(".browserSelector .confirm").on("click",e),$(".browserSelector .confirm").tap(e),$(".browserSelector .browsers").delegate(".versionSelector","change",o)}function initBrowserSelectorClickDelegate(){function e(){var e=browser.browserList,r=$(this),o=$(r.parent()),l=o.children(".platformSelector").val(),n=r.val(),i=null;o.children(".versionSelector").remove(),e.platform.map(function(e){e.code==l&&e.browsers.map(function(e){e.code==n&&(i=$('<select class="versionSelector"></select>'),i.hide(),i.append('<option value="unselected">请选择版本</option>'),e.versions.map(function(e){i.append("<option>"+e.code+"</option>")}),o.append(i),i.fadeIn())})})}function r(){var e=browser.browserList,r=$(this),o=$(r.parent()),l=r.val(),n=null;o.children(".familySelector").remove(),o.children(".versionSelector").remove(),e.platform.map(function(e){e.code==l&&(n=$('<select class="familySelector"></select>'),n.html(""),n.hide(),n.append('<option value="unselected">请选择浏览器</option>'),e.browsers.map(function(e){n.append("<option>"+e.code+"</option>")}),o.append(n),n.fadeIn())})}function o(){var e=browser.browserList,r=$('<select class="platformSelector"></select>'),o=$(this),l=$(o.parent());r.append('<option value="unselected">请选择操作系统</option>'),r.append('<option value="selfBrowser">您当前的浏览器</option>'),e.platform.map(function(e){r.append("<option>"+e.code+"</option>")}),r.hide(),l.append(r),$(this).fadeOut(function(){r.fadeIn()})}$(".browserSelector .browsers").delegate(".iconfont","click",o),$(".browserSelector .browsers").delegate(".platformSelector","change",r),$(".browserSelector .browsers").delegate(".familySelector","change",e),$(".browsers .iconfont").tap(o)}function initTableClickDelegate(){var e=$('<div class="more"></div>'),r=$('<div class="body"></div>'),o=$('<div class="arrow"></div>'),l=$("<div><div>");e.append(r),r.append(o),r.append(l),console.log(e);var n=null;e.hide(),$(".table").delegate(".reSelect","click",function(){$(".table").fadeOut(function(){$(".browserSelector").fadeIn()})}),$(".table").delegate(".col-title","click",function(){var r=$(this);n&&n.removeClass("active"),n=r.parent(),n.addClass("active"),e.slideUp(function(){r.parent().after(e),e.slideDown()}),css.get(r.html(),function(e,r){e?l.html("内容待补充..."):l.html(r)})})}function unique(e){for(var r=[],o=0;o<e.length;o++)-1==r.indexOf(e[o])&&r.push(e[o]);return r}function renderCssTable(e){console.log(e);var r=[],o=0;e.map(function(e){r=r.concat(e.css),e.valid&&o++}),r=unique(r),r.shift();var l=$('<div class="row row-title"></div>'),n=$('<div class="row row-title"></div>'),i=$('<div class="row row-title"></div>');l.append('<div class="col">平台</div>'),n.append('<div class="col">浏览器</div>'),i.append('<div class="col">版本</div>'),e.map(function(e){e.valid&&(l.append('<div class="col">'+e.platform+"</div>"),n.append('<div class="col">'+e.family+"</div>"),i.append('<div class="col">'+e.version+"</div>"))}),$(".table").html('<div class="reSelect"><i class="iconfont icon-true"></i> 重新选择</div>'),$(".table").append(l),$(".table").append(n),$(".table").append(i),r.map(function(r){var o=$('<div class="row"></div>');o.append('<div class="col col-title">'+r+"</div>"),e.map(function(e){if(e.valid){var l=-1==e.css.indexOf(r)?"false":"true";o.append('<div class="col"><i class="iconfont icon-'+l+'"></i></div>')}}),$(".table").append(o)}),$(".browserSelector").fadeOut(function(){$(".table").fadeIn()})}function initWallpaper(){var e=new wallpaper;e.getRandomWallpaper(function(e,r){if(!e){var o=new Image;o.onload=function(){$(".cover").css({"background-color":"rgba(0,0,0,1)"}),$("body").css({"background-image":"url("+r.response.image.preview.url+")"});var e=100,o=setInterval(function(){$(".cover").css({"background-color":"rgba(0,0,0,"+e/100+")"}),e--,65>e&&clearInterval(o)},100)},o.onerror=function(e){console.log(e)},o.src=r.response.image.preview.url}})}var browser=new Browser,css=new Css;$(document).ready(function(){initWallpaper(),browser.reportBrowserCss(),browser.initBrowserList(),initTableClickDelegate(),initBrowserSelectorClickDelegate(),initSelectComfirmClickDelegate()});