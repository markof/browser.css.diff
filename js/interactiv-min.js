function initSelectComfirmClickDelegate(){function e(){var e=o();if(e){var n=!1;return e.map(function(e){e.valid&&(n=!0)}),n?void r(e):(l(1,"请至少选择一个浏览器"),!1)}}function r(e){var r=0,o=e;o.map(function(e){if("selfBrowser"==e.valid){r++;var n=document.createElement("div"),l=[];for(var i in n.style)l.push(i);e.css=l,e.platform="您的浏览器",e.family="您的浏览器",e.version="您的浏览器",r--}else e.valid&&(r++,$.ajax({url:"http://markof.cn:8800/browser/",data:{platform:e.platform,family:e.family,version:e.version},dataType:"json",success:function(n){r--,e.css=n.cssInfo,0==r&&renderCssTable(o)},error:function(n){r--,e.valid=!1,0==r&&renderCssTable(o)}}))}),0==r&&renderCssTable(o)}function o(){for(var e=$(".browserSelector .browsers").children(),r=null,o="",i=[],a=0;a<e.length;a++){var t={index:a,valid:!1,platform:null,family:null,version:null},s=$(e[a]),c=s.children(".platformSelector").val(),d=s.children(".familySelector").val(),p=s.children(".versionSelector").val();if("undefined"!=typeof c&&"unselected"!=c)if("selfBrowser"!=c){if("unselected"==d||"unselected"==p){o="请完整选择“浏览器”和“版本”",r=a+1;break}t.valid=!0,t.platform=c,t.family=d,t.version=p,n(),i.push(t)}else t.valid="selfBrowser",i.push(t);else t.valid=!1,i.push(t)}return r?(l(r,o),null):i}function n(){var e=$(".browserSelector"),r=e.children(".more");r.slideUp(function(){r.remove()})}function l(e,r){var o=$('<div class="more"><div class="body"><div class="arrow arrow-position-'+e+'-4"></div><div class="message center">'+r+"</div></div></div>"),n=$(".browserSelector");n.children(".more").remove(),o.hide(),n.children(".browsers").after(o),o.slideDown()}$(".browserSelector .confirm").on("click",e),$(".browserSelector .confirm").tap(e),$(".browserSelector .browsers").delegate(".versionSelector","change",o)}function initBrowserSelectorClickDelegate(){function e(){var e=browser.browserList,r=$(this),o=$(r.parent()),n=o.children(".platformSelector").val(),l=r.val(),i=null;o.children(".versionSelector").remove(),e.platform.map(function(e){e.code==n&&e.browsers.map(function(e){e.code==l&&(i=$('<select class="versionSelector"></select>'),i.hide(),i.append('<option value="unselected">请选择版本</option>'),e.versions.map(function(e){i.append("<option>"+e.code+"</option>")}),o.append(i),i.fadeIn())})})}function r(){var e=browser.browserList,r=$(this),o=$(r.parent()),n=r.val(),l=null;o.children(".familySelector").remove(),o.children(".versionSelector").remove(),e.platform.map(function(e){e.code==n&&(l=$('<select class="familySelector"></select>'),l.html(""),l.hide(),l.append('<option value="unselected">请选择浏览器</option>'),e.browsers.map(function(e){l.append("<option>"+e.code+"</option>")}),o.append(l),l.fadeIn())})}function o(){var e=browser.browserList,r=$('<select class="platformSelector"></select>'),o=$(this),n=$(o.parent());r.append('<option value="unselected">请选择操作系统</option>'),r.append('<option value="selfBrowser">您当前的浏览器</option>'),e.platform.map(function(e){r.append("<option>"+e.code+"</option>")}),r.hide(),n.append(r),$(this).fadeOut(function(){r.fadeIn()})}$(".browserSelector .browsers").delegate(".iconfont","click",o),$(".browserSelector .browsers").delegate(".platformSelector","change",r),$(".browserSelector .browsers").delegate(".familySelector","change",e),$(".browsers .iconfont").tap(o)}function initTableClickDelegate(){var e=$('<div class="more"></div>'),r=$('<div class="body"></div>'),o=$('<div class="arrow"></div>'),n=$("<div><div>");e.append(r),r.append(o),r.append(n),console.log(e);var l=null;e.hide(),$(".table").delegate(".reSelect","click",function(){$(".table").fadeOut(function(){$(".browserSelector").fadeIn()})}),$(".table").delegate(".col-title","click",function(){var r=$(this);l&&l.removeClass("active"),l=r.parent(),l.addClass("active"),e.slideUp(function(){r.parent().after(e),e.slideDown()}),css.get(r.html(),function(e,r){e?n.html("内容待补充..."):n.html(r)})})}function unique(e){for(var r=[],o=0;o<e.length;o++)-1==r.indexOf(e[o])&&r.push(e[o]);return r}function renderCssTable(e){console.log(e);var r=[],o=0;e.map(function(e){r=r.concat(e.css),e.valid&&o++}),r=unique(r),r.shift();var n=$('<div class="row row-title"></div>'),l=$('<div class="row row-title"></div>'),i=$('<div class="row row-title"></div>');n.append('<div class="col">平台</div>'),l.append('<div class="col">浏览器</div>'),i.append('<div class="col">版本</div>'),e.map(function(e){e.valid&&(n.append('<div class="col">'+e.platform+"</div>"),l.append('<div class="col">'+e.family+"</div>"),i.append('<div class="col">'+e.version+"</div>"))}),$(".table").html('<div class="reSelect"><i class="iconfont icon-true"></i> 重新选择</div>'),$(".table").append(n),$(".table").append(l),$(".table").append(i),r.map(function(r){var o=$('<div class="row"></div>');o.append('<div class="col col-title">'+r+"</div>"),e.map(function(e){if(e.valid){var n=-1==e.css.indexOf(r)?"false":"true";o.append('<div class="col"><i class="iconfont icon-'+n+'"></i></div>')}}),$(".table").append(o)}),$(".browserSelector").fadeOut(function(){$(".table").fadeIn()})}function initWallpaper(){var e="http://127.0.0.1:8080/img/safebackground.jpg",r=new wallpaper;r.getRandomWallpaper(function(r,o){if(r)console.log("sjdlfjaldjflkajdklfjalksdjflkasjdf"),fadinBackground(e);else{var n=new Image;n.src=o.response.image.preview.url,n.onload=fadinBackground(o.response.image.preview.url),n.onerror=function(r){fadinBackground(e)}}})}function fadinBackground(e){$(".cover").css({"background-color":"rgba(0,0,0,1)"}),$("body").css({"background-image":"url("+e+")"});var r=100,o=setInterval(function(){$(".cover").css({"background-color":"rgba(0,0,0,"+r/100+")"}),r--,65>r&&clearInterval(o)},100)}var browser=new Browser,css=new Css;$(document).ready(function(){initWallpaper(),browser.reportBrowserCss(),browser.initBrowserList(),initTableClickDelegate(),initBrowserSelectorClickDelegate(),initSelectComfirmClickDelegate()});